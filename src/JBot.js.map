{"version":3,"sources":["/home/sarkian/dev/js/jbot/src/JBot.es6"],"names":[],"mappings":";;;;;;AAAA,IAAI,OAAO,GAAG,OAAO,CAAC,SAAS,CAAC;;;AAE5B,eAAe,GAAG,OAAO,CAAC,wBAAwB,CAAC;IACnD,OAAO,GAAG,OAAO,CAAC,UAAU,CAAC;IAC7B,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC;IACxB,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAC7B;;AAED,IAAI,YAAY,GAAG,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;AAC3C,OAAO,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;;IAItB,IAAI;AAiBK,aAjBT,IAAI,CAiBM,UAAU,EAAE;8BAjBtB,IAAI;;AAkBF,YAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;AACnB,YAAI,CAAC,YAAY,GAAG,SAAS,CAAC;AAC9B,YAAG,UAAU,EACT,IAAI,CAAC,YAAY,GAAG,IAAI,eAAe,CAAC,UAAU,CAAC,CAAC;;;;;;;;;AASxD,YAAI,CAAC,IAAI,GAAG,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;AAC3C,YAAI,CAAC,IAAI,GAAG,OAAO,CAAC,QAAQ,CAAC,EAAC,GAAG,EAAE,IAAI,CAAC,IAAI,EAAC,CAAC,CAAC;AAC/C,eAAO,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;KACnC;;iBAjCC,IAAI;;eAoCI,oBAAC,OAAO,EAAE;AAChB,gBAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;AACxB,mBAAO,IAAI,CAAC;SACf;;;eAGE,aAAC,GAAG,EAAE,OAAO,EAAE;AACd,mBAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,cAAc,CAAC;AAC1C,kCAAkB,EAAE,IAAI;AACxB,uBAAO,EAAE,IAAI,CAAC,QAAQ;AACtB,wBAAQ,EAAE,IAAI;aACjB,EAAE,OAAO,CAAC,CAAC,CAAC;SAChB;;;eAGG,cAAC,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE;AACrB,mBAAO,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC;AACtC,mBAAG,EAAE,GAAG;AACR,wBAAQ,EAAE,IAAI;AACd,kCAAkB,EAAE,IAAI;AACxB,uBAAO,EAAE,IAAI,CAAC,QAAQ;AACtB,wBAAQ,EAAE,IAAI;aACjB,EAAE,OAAO,CAAC,CAAC,CAAC;SAChB;;;eAGM,iBAAC,GAAG,EAAE,OAAO,EAAE;AAClB,mBAAO,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC,MAAM,CAAC,UAAS,GAAG,EAAE,IAAI,EAAE;AACrD,uBAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;aACtC,CAAC,CAAC;SACN;;;eAGO,kBAAC,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE;AACzB,mBAAO,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC,MAAM,CAAC,UAAS,GAAG,EAAE,IAAI,EAAE;AAC5D,uBAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;aACtC,CAAC,CAAC;SACN;;;eAGK,gBAAC,GAAG,EAAE,OAAO,EAAE;AACjB,mBAAO,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SACnE;;;eAGM,iBAAC,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE;AACxB,mBAAO,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;SAC1E;;;eAGQ,mBAAC,GAAG,EAAE,IAAI,EAAE;AACjB,gBAAI,IAAI,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;AAC3B,mBAAO,KAAK,CAAC,QAAQ,CAAC,IAAI,EAAE;AACxB,oBAAI,EAAE,IAAI;AACV,mBAAG,EAAE,GAAG,CAAC,OAAO,CAAC,IAAI;aACxB,CAAC,CAAC,IAAI,CAAC,UAAS,MAAM,EAAE;AACrB,uBAAO,CAAC,MAAM,EAAE,MAAM,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,CAAC;aACzC,CAAC,CAAC;SACN;;;eA3FoB,0BAAG;AACpB,gBAAI,GAAG,GAAG,EAAE,CAAC;AACb,gBAAI,GAAG,GAAG,SAAS,CAAC,MAAM,CAAC;AAC3B,iBAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;AACzB,qBAAI,IAAI,CAAC,IAAI,SAAS,CAAC,CAAC,CAAC,EAAE;AACvB,wBAAG,SAAS,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE;AAC/B,2BAAG,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;qBAC5B;iBACJ;aACJ;AACD,mBAAO,GAAG,CAAC;SACd;;;WAdC,IAAI;;;AAoGV,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC","file":"JBot.js","sourcesContent":["var request = require('request'),\n    //FileCookieStore = require('file-cookie-store'),\n    FileCookieStore = require('tough-cookie-filestore'),\n    Promise = require('bluebird'),\n    jsdom = require('jsdom'),\n    jquery = require('jquery')\n;\n\nvar requestAsync = Promise.method(request);\nPromise.promisifyAll(jsdom);\n\n\n\nclass JBot {\n    \n    \n    static collectOptions() {\n        var ret = {};\n        var len = arguments.length;\n        for(var i = 0; i < len; i++) {\n            for(var p in arguments[i]) {\n                if(arguments[i].hasOwnProperty(p)) {\n                    ret[p] = arguments[i][p];\n                }\n            }\n        }\n        return ret;\n    }\n    \n    \n    constructor(cookieFile) {\n        this._headers = {};\n        this._cookieStore = undefined;\n        if(cookieFile)\n            this._cookieStore = new FileCookieStore(cookieFile);\n            //this._cookieStore = new FileCookieStore(cookieFile, {\n            //    force_parse: false,\n            //    lockfile: true,\n            //    mode: 644,\n            //    http_only_extension: true,\n            //    lockfile_retries: 200,\n            //    auto_sync: true\n            //});\n        this._jar = request.jar(this._cookieStore);\n        this._req = request.defaults({jar: this._jar});\n        Promise.promisifyAll(this._req);\n    }\n    \n    \n    setHeaders(headers) {\n        this._headers = headers;\n        return this;\n    }\n    \n    \n    get(url, options) {\n        return this._req.getAsync(url, collectOptions({\n            followAllRedirects: true,\n            headers: this._headers,\n            encoding: null\n        }, options));\n    }\n    \n    \n    post(url, data, options) {\n        return this._req.postAsync(collectOptions({\n            url: url,\n            formData: data,\n            followAllRedirects: true,\n            headers: this._headers,\n            encoding: null\n        }, options));\n    }\n    \n    \n    getJSON(url, options) {\n        return this.get(url, options).spread(function(ret, body) {\n            return JSON.parse(body.toString());\n        });\n    }\n    \n    \n    postJSON(url, data, options) {\n        return this.post(url, data, options).spread(function(ret, body) {\n            return JSON.parse(body.toString());\n        });\n    }\n    \n    \n    getDOM(url, options) {\n        return this.get(url, options).spread(this._jquerify.bind(this));\n    }\n    \n    \n    postDOM(url, data, options) {\n        return this.post(url, data, options).spread(this._jquerify.bind(this));\n    }\n    \n    \n    _jquerify(ret, body) {\n        var html = body.toString();\n        return jsdom.envAsync(html, {\n            html: html,\n            url: ret.request.href\n        }).then(function(window) {\n            return [window, jquery(window), html];\n        });\n    }\n    \n    \n}\n\n\nmodule.exports = JBot;"]}